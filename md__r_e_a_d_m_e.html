<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SecOS: Examen SecOS - (c) Airbus</title>
<link rel="icon" href="logo.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">SecOS
   </div>
   <div id="projectbrief">OS multi-tâches </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__r_e_a_d_m_e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Examen SecOS - (c) Airbus</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<p>L'examen consiste en la création d'un OS multi-tâches , en vous appuyant sur vos connaissances du cours et les mini TPs réalisés.</p>
<p>Vous êtes libres de modifier l'intégralité du noyau si vous le jugez nécessaire.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md2"></a>
Objectifs</h1>
<p>Permettre un ordonnancement  de 2 tâches (T1 et T2) en ring 3 :</p>
<ul>
<li>Le code et les données des tâches seront inclus dans le noyau à la compilation, comme nous l'avons fait dans les TPs précédents pour la fonction <code>userland()</code>.</li>
<li>Chaque tâche sera représentée par une fonction (ex. <code>user1()</code>, <code>user2()</code>) exécutant une boucle infinie.</li>
<li>La pagination doit être activée:<ul>
<li>Le noyau est identity mappé</li>
<li>Les tâches sont identity mappées</li>
<li>Les tâches possèdent leurs propres PGD/PTB</li>
<li>Les tâches ont une zone de mémoire partagée :<ul>
<li>De la taille d'une page (4KB)</li>
<li>À l'adresse physique de votre choix</li>
<li>À des adresses virtuelles différentes</li>
</ul>
</li>
<li>Les tâches doivent avoir leur propre pile noyau (4KB)</li>
<li>Les tâches doivent avoir leur propre pile utilisateur (4KB)</li>
</ul>
</li>
<li>La tâche 1 écrit un compteur (uint32_t) dans la zone de mémoire partagée</li>
<li>La tâche 2 affiche le compteur depuis la zone de mémoire partagée</li>
<li>L'affichage dans la tâche 2 s'effectuera à l'aide d'un appel système :<ul>
<li>L'interface utilisateur :<ul>
<li>A le prototype: <code>void <a class="el" href="tp_8c.html#a4df710274006d92c3b822b822df09383" title="Appel système pour afficher un compteur.">sys_counter(uint32_t *counter)</a>;</code></li>
<li>Notez bien que l'argument est une adresse virtuelle ring 3</li>
</ul>
</li>
<li>L'interface noyau :<ul>
<li>Est installée à l'interruption <code>0x80</code></li>
<li>Reçoit un pointeur utilisateur de type <code>uint32_t*</code></li>
<li>S'occupe de l'affichage du compteur (via <code>debug()</code>)</li>
</ul>
</li>
</ul>
</li>
<li>Le gestionnaire de l'interruption 32 (irq0 = horloge) doit vous permettre à chaque interruption de passer de la tâche 1 à la tâche 2 et inversement. Il doit également savoir détecter s'il a interrompu le noyau ou une tâche utilisateur.</li>
<li>Une fois la mémoire, les interruptions et les tâches initialisées, le noyau doit activer les interruptions matérielles et effectuer une boucle infinie.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md4"></a>
Astuces</h1>
<ul>
<li>Faites vous une cartographie mémoire complète pour vous y retrouver : . Adresses physiques noyau . Adresses physiques utilisateurs . Adresses virtuelles utilisateurs</li>
<li>Vous pouvez modifier le linker script afin de situer votre code utilisateur à des adresses physiques pratiques (alignées sur une entrée de PDE par exemple (ex 4MB, 8MB). Ceci vous aidera à configurer le PGD des tâches ring 3. Pour cela il faut :<ul>
<li>Créer une section ".user" dans linker.lds</li>
<li>Préfixer vos fonctions <code>user1()</code> et <code>user2()</code> avec l'attribut de section GCC <code>__attribute__((section(".user")))</code>.</li>
<li>Regardez "include/mbi.h" et "core/start.c" pour vous inspirer de la manière dont les en-têtes multiboot sont déclarées.</li>
<li>Vous pouvez également créer une section pour les données user. Cette section pourrait contenir les piles user, la page de mémoire partagée par exemple.</li>
</ul>
</li>
<li>Faites attention aux droits des PDEs/PTEs ... ils sont combinés !</li>
<li>Les piles avancent à l'envers ! On part des adresses hautes.</li>
<li>La première exécution d'une tâche est un peu délicate à mettre en oeuvre. Pensez bien au chemin d'exécution (retours successifs d'appels de fonctions) qu'elle va devoir parcourir avant d'atteindre l'instruction "iret" responsable de la bascule en ring 3. Il s'agît de correctement initialiser le contexte d'interruption initial de la tâche, au sommet de sa pile noyau.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md6"></a>
À rendre</h1>
<p>J'attends un patch qui compile et me permet de tester votre travail. Je vous conseille de "cloner" à nouveau le repo git de secos et de commencer l'examen depuis cette base saine dans une nouvelle branche (et non pas depuis votre working directory utilisé pour les mini TPs).</p>
<p>Note : Me partager, dans le format de votre choix (.md, .jpg, .pdf, etc.) une documentation succinte de vos choix de cartographie mémoire serait un plus.</p>
<p>Un exemple de workflow: </p><div class="fragment"><div class="line">$ git clone https://github.com/agantet/secos-ng</div>
<div class="line">$ cd secos</div>
<div class="line">$ git checkout -b exam</div>
<div class="line"> </div>
<div class="line">$ emacs ... gcc ... rage !</div>
<div class="line">$ emacs ... gcc ... fear !</div>
<div class="line">$ emacs ... gcc ... rulz :)</div>
<div class="line"> </div>
<div class="line">$ git add &lt;file&gt;</div>
<div class="line">$ git commit -m &quot;exam finished&quot;</div>
<div class="line">$ git format-patch $(git merge-base --fork-point master)..exam</div>
<div class="line">$ tar czf nom.prenom.tar.gz *.patch</div>
</div><!-- fragment --><p>Ceci vous génère une archive compressée contenant vos modifications, que vous pouvez m'envoyer par mail. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.0 </li>
  </ul>
</div>
</body>
</html>
